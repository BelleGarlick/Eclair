<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>

<style>
    .child {
        position: absolute; 
        top: 0px; 
        left: 0px; 
        width: 100%; 
        height: 100%;
        margin: 10px;
        padding: 10px;
        font-size: 14px;
        font-family: monospace;
        border: 0px
    }
</style>
    
<div style="position: relative; width: 500px; height: 500px; overflow: hidden;">
    <div class="child">
        <code><pre style="margin: 0px; padding: 0px;" id='code-output'></pre></code>
    </div>
    <textarea class="child" style="background: transparent; color: rgb(1, 1, 1, 0.4)" id='code-box' cols=50 rows=0>// Example Toggle Code
let toggleOn = Ø(true)
let toggleTick = Ø(false)
let toggleEnabled = Ø(true)

// Create layout
eclair.VStack([
    // Attach states to toggle
    eclair.VStack([
        eclair.Toggle(toggleOn)
            .showTick(toggleTick)
            .enabled(toggleEnabled)
    ]).width("100%"),

    eclair.HorizontalLine(),

    // Tick mark toggle
    eclair.Text("Tick Mark"),
    eclair.Toggle(toggleTick),

    // Toggle toggle
    eclair.Text("'Toggle'"),
    eclair.Toggle(true)
        .onChange(e => {
		toggleOn.toggle()
	}),

    // Toggle enabled
    eclair.Text("Enabled"),
    eclair.Toggle(toggleEnabled)
])
    .alignment(eclair.Alignment().start())
    .gap("8px")
    .write()</textarea>
</div>

<br/>
    
<script>
let code = document.getElementById('code-box').value;

var isComment = false
var isString = false;
var isQuote = false;

var lastChar = null;
var currentToken = "";

let tokenSeperators = new Set([
	"{", "(", " ", "}", ")", "[", "]", "\n", "\t", "."
])
let eclairKeywords = new Set([
	"VStack", "HStack", "State", "Toggle", "Text", "HorizontalLine", "Alignment", "eclair", "Ø"
])
let jsKeywords = new Set([
	"let", "var", "if", "true", "false", "const", "for", "while"
])


function tokeniseLine(line) {
    let tokens = []
    let token = ""
    let state = ""
    
    function pushTokenState(_text, _state) {
        if (state == "") {
            if (jsKeywords.has(_text)) {_state = "keyword"}
            if (eclairKeywords.has(_text)) {_state = "eclair"}
        }
        
        tokens.push({
            "text": _text,
            "type": _state
        })
        state = ""
        token = ""
    }
    
    for (let c = 0; c < line.length; c++) {
        if (state == "comment") {
            token += line[c]
        } 
        
        else if (state != "comment" && c < code.length - 1 && line[c] == "/" && line[c + 1] == "/") {
            pushTokenState(token, state)
            
            state = "comment"
            token = line[c]
        } 
        
        else if (state != "quote" && state != "string" && line[c] == "'") {
            pushTokenState(token, state)
            
            state = "quote"
            token = line[c]
        } 
        
        else if (state == "quote" && line[c] == "'") {
            pushTokenState(token + "'", state)
        } 
        
        else if (state == "string" && line[c] == '"') {
            pushTokenState(token + '"', state)
        } 
        
        else if (state != "string" && state != "quote" && line[c] == '"') {
            pushTokenState(token, state)
            
            state = "string"
            token = line[c]
        } 
        
        else if (state != "string" && state != "quote" && tokenSeperators.has(line[c])) {
            pushTokenState(token, state)
            token = line[c]
        }
        
        else {
            if (tokenSeperators.has(token)) {
                pushTokenState(token, state)
            }
            token += line[c]
        }
    }
    
    tokens.push({
        "text": token,
        "type": state
    })
    
    console.log(tokens)
    
    return tokens
}

let output = "";
let tokenisedLines = []

let lines = code.split("\n")
for (let l = 0; l < lines.length; l++) {
    tokenisedLines.push(
        tokeniseLine(lines[l])
    )
}
    
    
colors = {
    "comment": "grey",
    "keyword": "blue",
    "eclair": "green",
    "string": "orange",
    "quote": "orange",
}
    

let formattedCode = ""
for (let l = 0; l < tokenisedLines.length; l++) {
    let cline = tokenisedLines[l];
    for (let t = 0; t < cline.length; t++) {
        formattedCode += "<span style='color:"+colors[cline[t].type]+"'>" + cline[t].text + "</span>"
    }
    formattedCode += "<br/>"
}

document.getElementById("code-output").innerHTML = formattedCode
</script>

</body>
</html>

